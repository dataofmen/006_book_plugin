# TOC 추출 시스템 테스트 가이드

새로운 세션 기반 TOC(목차) 추출 시스템의 성능을 검증하고 성공률을 측정하는 종합적인 테스트 도구입니다.

## 🎯 테스트 목표

- **목표 성공률**: 70% 이상 (기존 ~5%에서 대폭 개선)
- **평균 응답시간**: 10초 이하
- **다양한 도서 유형**: 일반서, 학술서, 시리즈, 어린이, 전자책

## 🚀 빠른 시작

### 1. 의존성 설치
```bash
cd /Users/hmkwon/Project/006_book_plugin
npm install
```

### 2. API 키 설정
```bash
# 환경변수로 설정 (권장)
export NLK_API_KEY="your_actual_api_key_here"

# 또는 src/test/run-test.ts 파일에서 직접 수정
```

### 3. 테스트 실행
```bash
# 전체 테스트 스위트 실행 (14권 도서)
npm run test-toc

# 특정 카테고리만 테스트
npm run test-toc -- --category general
npm run test-toc -- --category academic
npm run test-toc -- --category children

# 도움말 보기
npm run test-toc -- --help
```

## 📊 테스트 구조

### 테스트 도서 (14권)
- **일반서**: 코스모스, 사피엔스, 총균쇠, 나미야 잡화점의 기적, 미움받을 용기
- **학술서**: 자바의 정석, Clean Code, 컴퓨터구조론
- **시리즈**: 해리 포터와 마법사의 돌, 원피스
- **어린이**: 마법천자문, 과학동아
- **전자책**: 디지털 마케팅, 인공지능 시대의 교육

### 측정 항목
- **성공률**: 목차 추출 성공 여부
- **방법별 성능**: 각 추출 방법의 성공률
- **카테고리별 성능**: 도서 유형별 성공률
- **응답시간**: 평균 처리 시간
- **오류 분석**: 실패 원인 분류

## 🔧 새로운 시스템 특징

### SessionManager (세션 관리자)
- 국립중앙도서관 웹사이트와의 인증 세션 관리
- 쿠키 기반 상태 유지
- 적절한 HTTP 헤더 설정 (Referer, User-Agent)

### TableOfContentsService (목차 추출 서비스)
- **방법 1**: BOOK_TB_CNT_URL을 통한 세션 기반 접근
- **방법 2**: 상세 페이지를 통한 세션 기반 HTML 파싱
- **방법 3**: TXT 다운로드 API를 통한 세션 기반 추출
- **폴백**: 기존 방식으로 복구

### ErrorHandler (오류 처리기)
- 사용자 친화적 오류 메시지 (한국어)
- 기술적 세부사항과 권장 조치사항 제공
- 성공/실패 상황별 상세한 피드백

## 📁 결과 저장

테스트 완료 후 `src/test/results/` 디렉토리에 저장됩니다:
- **JSON**: 상세한 테스트 데이터
- **CSV**: 스프레드시트 분석용
- **Markdown**: 읽기 쉬운 보고서 형식

## 🎯 성능 평가 기준

### 성공률 기준
- **🎉 목표 달성**: 70% 이상
- **🤔 개선 필요**: 50-70%
- **⚠️ 대폭 개선 필요**: 30-50%
- **🚨 심각한 문제**: 30% 미만

### 응답시간 기준
- **⚡ 양호**: 5초 이하
- **⚠️ 보통**: 5-10초
- **🐌 느림**: 10초 초과

## 🔍 문제 해결

### 자주 발생하는 오류

1. **API 키 오류**
   ```
   ❌ API 키를 설정해주세요!
   ```
   → 환경변수 `NLK_API_KEY` 설정 확인

2. **네트워크 오류**
   ```
   ❌ 네트워크 연결에 문제가 있습니다
   ```
   → 인터넷 연결 및 VPN 상태 확인

3. **세션 설정 실패**
   ```
   ❌ 세션 설정에 실패했습니다
   ```
   → 국립중앙도서관 사이트 상태 확인

### 디버깅 옵션

SessionManager와 TOCService에서 상세한 로그를 출력합니다:
```
🔧 [SessionManager-INFO] 세션 설정 완료. 저장된 쿠키 수: 3
🔧 [TOCService-INFO] 방법 1 시도: session-book-tb-cnt-url
📚 [TOC] 추출 성공: 방법=session-book-tb-cnt-url, 길이=2547글자
```

## 📈 결과 해석

### 예시 출력
```
📊 전체 결과:
   📚 총 테스트: 14권
   ✅ 성공: 10권
   ❌ 실패: 4권
   📈 성공률: 71.4%
   ⏱️ 평균 응답시간: 6850ms

🔧 방법별 성공률:
   session-book-tb-cnt-url: 6/8 (75.0%)
   session-detail-page: 3/4 (75.0%)
   session-txt-download: 1/2 (50.0%)

🎯 성능 평가:
   🎉 목표 달성! (70% 이상)
   ⚡ 응답속도 양호 (6.9초)
```

## 🎯 다음 단계

1. **테스트 결과 분석**: 실패한 도서들의 수동 검증
2. **성능 최적화**: 응답시간 개선 및 캐싱 구현
3. **추가 방법 구현**: Playwright 브라우저 자동화
4. **프로덕션 배포**: 사용자 인터페이스에 진행률 표시 추가
5. **모니터링**: 실제 사용 환경에서의 성능 추적

## 🤝 기여 방법

테스트 도서를 추가하거나 새로운 추출 방법을 제안하려면:
1. `src/test/toc-test-suite.ts`의 `testBooks` 배열에 도서 추가
2. 새로운 카테고리나 특수 상황 고려
3. 테스트 실행 후 결과 분석 및 개선안 제시

---

**참고**: 이 테스트 도구는 개발 환경에서만 사용하며, 실제 플러그인 사용자에게는 영향을 주지 않습니다.